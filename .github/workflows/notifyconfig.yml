name: Notify RDObeheer on config-changes

on:
  push:
    branches: [ main ]
    paths: [ 'max.conf.example', 'clients.json.example' ]

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Diff configfiles
        run: git diff master~1:max.conf.example max.conf.example > max.conf.diff
      - name: Diff configfiles
        run: git diff master~1:clients.example.json clients.example.json > clients.json.diff
      - name: Send mail
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.prolocation.net
          server_port: 587
          username: ${{secrets.MAIL_USERNAME}}
          password: ${{secrets.MAIL_PASSWORD}}
          subject: Github Actions ${{github.repository}}
          to: fyi@rdobeheer.nl
          from: Github actions <${{secrets.MAIL_USERNAME}}>
          secure: false
          body: >
             Config change in ${{github.repository}}
          attachments: max.conf.diff,clients.json.diff
          ignore_cert: false
          convert_markdown: false
