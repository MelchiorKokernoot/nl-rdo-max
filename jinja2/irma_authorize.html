<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Notificaties - Rijksoverheid CSS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="static/css/manon-mint-green.css" rel="stylesheet">
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script> <!-- todo: CDN allowed? -->
</head>

<main id="main-content" tabindex="-1">

    <section class="bg-color-offset auth">
        <div>
            <h1>Inloggen {{ ura_name }}</h1>

            <div class="explanation" role="group" aria-label="toelichting">
                <span>Toelichting:</span>
                <p>Scan de QR code met de IRMA app om door te gaan met inloggen.</p>
            </div>

            <div class="tile options-overview">
                <div id="qr-code"></div>
            </div>
        </div>
    </section>
</main>
<script>
    new QRCode(document.getElementById("qr-code"), {
        text: atob('{{ qr_code }}'),
        width: 500,
        height: 500,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });
    const check_redirect = async function () {
        const valid_states = ["INITIALIZED", "CONNECTED", "DONE"]
        const session = await fetch('{{session_url}}')
        const session_state = await session.json()
        if (!valid_states.includes(session_state.status)) {
            location.reload();
        }
        console.log(session_state)
        if (session_state.redirect_url !== undefined) {
            window.location.href = session_state.redirect_url;
        }
    }
    setInterval(check_redirect, 500);
</script>
</html>
